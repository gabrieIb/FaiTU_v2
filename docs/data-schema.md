# Google Sheets Data Schema

The spreadsheet now holds just the information needed for two people to plan meals together: proposals, their ingredients, and the derived shopping list. All timestamps are ISO-8601 (`2025-10-12T09:00:00Z`). Boolean flags use `TRUE` / `FALSE` in the sheet.

## Tabs overview

| Tab | Purpose | Primary key |
| --- | --- | --- |
| `MenuPlan` | One row per planned meal | `proposal_id` |
| `MenuIngredients` | Ingredients attached to a proposal | `ingredient_id` |
| `ShoppingList` | Auto-generated rows for items flagged “need to buy” | `shopping_id` |

## MenuPlan

| Column | Type | Required | Description |
| --- | --- | --- | --- |
| `proposal_id` | string | yes | UUID generated by the app. |
| `meal_slot` | string | yes | Friendly label for positioning the meal (e.g. “Pranzo”, “Cena”). |
| `title` | string | yes | Meal idea (“Lasagne”). |
| `notes` | string | no | Extra comments or prep reminders. |
| `created_by` | string | yes | Author label (kept simple, not an e-mail). |
| `created_at` | datetime | yes | Set on first insert. |
| `updated_at` | datetime | yes | Updated on every edit. |

## MenuIngredients

| Column | Type | Required | Description |
| --- | --- | --- | --- |
| `ingredient_id` | string | yes | UUID per ingredient row. |
| `proposal_id` | string | yes | References `MenuPlan.proposal_id`. |
| `name` | string | yes | Ingredient label shown in the app. |
| `need_to_buy` | boolean | yes | `TRUE` if it must appear in the shared shopping list. |
| `updated_at` | datetime | yes | Touched whenever the row changes. |

## ShoppingList

Rows are regenerated by Apps Script every time a proposal or ingredient changes. You should not edit this tab manually.

| Column | Type | Description |
| --- | --- | --- |
| `shopping_id` | string | Mirrors the corresponding `ingredient_id` so Android can reconcile, or an ad-hoc UUID for manual notes. |
| `ingredient_id` | string | Same id as the ingredient row. Empty for manual shopping notes. |
| `proposal_id` | string | Proposal that requires the ingredient. Empty when not linked. |
| `name` | string | Copied from the ingredient. |
| `status` | enum(`pending`) | Always `pending`; the app clears the row once the item is marked purchased. |
| `updated_at` | datetime | Regeneration timestamp. |

## Regeneration rules

- Editing or deleting a proposal removes linked ingredients and regenerates the shopping list (manual notes are preserved).
- Marking an ingredient as “Ce l’abbiamo” flips `need_to_buy` to `FALSE` and removes it from the shopping tab on the next sync.
- Marking an item “Segna come acquistato” in the app sets `need_to_buy` to `FALSE`, so the next regeneration drops it from `ShoppingList`.

## CSV templates

Import the CSV files under `sheets-template/` to seed a fresh spreadsheet:

- `MenuPlan.csv`
- `MenuIngredients.csv`
- `ShoppingList.csv`

They provide example data and, more importantly, the column headers expected by the Apps Script backend.
